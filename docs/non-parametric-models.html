<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Angel Feliz">

<title>An Introduction to Statistical Learning (Non Official Solution Book) - 7&nbsp; Non-parametric Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./resampling-methods.html" rel="next">
<link href="./flexible-regression.html" rel="prev">
<link href="./cover.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="summary-format.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">An Introduction to Statistical Learning (Non Official Solution Book)</span>
    </a>
  </div>
          <div class="quarto-toggle-container ms-auto">
              <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Teorical Summary</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modeling-process.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Strategy to implement machine learning solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./missing-values.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Dealing with missingness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-performance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Understanding model performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized-linear-models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Generalized linear models (GLM)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generative-classification-models.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generative Models for Classiﬁcation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./flexible-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Flexible Regression Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./non-parametric-models.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./resampling-methods.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Exercise Solutions</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-execises.html" class="sidebar-item-text sidebar-link">02 - Statistical Learning</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-execises.html" class="sidebar-item-text sidebar-link">03 - Linear Regression</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-execises.html" class="sidebar-item-text sidebar-link">04 - Classification</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-execises.html" class="sidebar-item-text sidebar-link">05 - Resampling Methods</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#k-nearest-neighbors-knn" id="toc-k-nearest-neighbors-knn" class="nav-link active" data-scroll-target="#k-nearest-neighbors-knn"><span class="toc-section-number">7.1</span>  K-nearest neighbors (KNN)</a>
  <ul>
  <li><a href="#classiﬁer" id="toc-classiﬁer" class="nav-link" data-scroll-target="#classiﬁer"><span class="toc-section-number">7.1.1</span>  Classiﬁer</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="toc-section-number">7.1.2</span>  Regression</a></li>
  <li><a href="#pre-processing" id="toc-pre-processing" class="nav-link" data-scroll-target="#pre-processing"><span class="toc-section-number">7.1.3</span>  Pre-processing</a></li>
  <li><a href="#coding-example" id="toc-coding-example" class="nav-link" data-scroll-target="#coding-example"><span class="toc-section-number">7.1.4</span>  Coding example</a></li>
  </ul></li>
  <li><a href="#tree-based-methods" id="toc-tree-based-methods" class="nav-link" data-scroll-target="#tree-based-methods"><span class="toc-section-number">7.2</span>  Tree-Based Methods</a>
  <ul>
  <li><a href="#simple-trees" id="toc-simple-trees" class="nav-link" data-scroll-target="#simple-trees"><span class="toc-section-number">7.2.1</span>  Simple trees</a>
  <ul class="collapse">
  <li><a href="#regression-1" id="toc-regression-1" class="nav-link" data-scroll-target="#regression-1">Regression</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  <li><a href="#advantages-and-disadvantages" id="toc-advantages-and-disadvantages" class="nav-link" data-scroll-target="#advantages-and-disadvantages">Advantages and disadvantages</a></li>
  </ul></li>
  <li><a href="#bagging-bootstrap-aggregation" id="toc-bagging-bootstrap-aggregation" class="nav-link" data-scroll-target="#bagging-bootstrap-aggregation"><span class="toc-section-number">7.2.2</span>  Bagging (bootstrap aggregation)</a>
  <ul class="collapse">
  <li><a href="#out-of-bag-error-estimation" id="toc-out-of-bag-error-estimation" class="nav-link" data-scroll-target="#out-of-bag-error-estimation">Out-of-bag error estimation</a></li>
  <li><a href="#variable-importance-measures" id="toc-variable-importance-measures" class="nav-link" data-scroll-target="#variable-importance-measures">Variable importance measures</a></li>
  </ul></li>
  <li><a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="toc-section-number">7.2.3</span>  Random Forests</a></li>
  <li><a href="#boosting" id="toc-boosting" class="nav-link" data-scroll-target="#boosting"><span class="toc-section-number">7.2.4</span>  Boosting</a></li>
  <li><a href="#bayesian-additive-regression-trees-bart" id="toc-bayesian-additive-regression-trees-bart" class="nav-link" data-scroll-target="#bayesian-additive-regression-trees-bart"><span class="toc-section-number">7.2.5</span>  Bayesian additive regression trees (BART)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="k-nearest-neighbors-knn" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="k-nearest-neighbors-knn"><span class="header-section-number">7.1</span> K-nearest neighbors (KNN)</h2>
<p>It uses the principle of nearest neighbors to classify unlabeled examples by using the <strong>Euclidean Distance</strong> to calculate distance between the point we want to predict and <span class="math inline">\(k\)</span> closest neighbors on the training data.</p>
<p><span class="math display">\[
d\left( a,b\right)   = \sqrt {\sum _{i=1}^{p}  \left( a_{i}-b_{i}\right)^2 }
\]</span></p>
<p>KNN unlike parametric models does not tell us which predictors are important, making it hard to make inferences using this model.</p>
<p>This method performs worst than a parametric as we starting adding <em>noise</em> predictors. In fact, we will get in the situation where for a given observation has no <em>nearby neighbors</em>, known as <strong>curse of dimensionality</strong> and leading to a very poor prediction of <span class="math inline">\(f(x_{0})\)</span>.</p>
<section id="classiﬁer" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="classiﬁer"><span class="header-section-number">7.1.1</span> Classiﬁer</h3>
<p>The next function estimates the conditional probability for class <span class="math inline">\(j\)</span> as the fraction of points in <span class="math inline">\(N_{0}\)</span> whose response values equal <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[
\text{Pr}(Y = j|X = x_{0}) = \frac{1}{K}
                      \displaystyle\sum_{i \in N_{0}} I(y_{i} = j)
\]</span></p>
<ul>
<li>Where
<ul>
<li><span class="math inline">\(j\)</span> response value to test</li>
<li><span class="math inline">\(x_{0}\)</span> is the test observation</li>
<li><span class="math inline">\(K\)</span> the number of points in the training data that are closest to <span class="math inline">\(x_{0}\)</span> and reduce the model flexibility</li>
<li><span class="math inline">\(N_{0}\)</span> points in the training data that are closest to <span class="math inline">\(x_{0}\)</span></li>
</ul></li>
</ul>
<p>Then KNN classiﬁes the test observation <span class="math inline">\(x_{0}\)</span> to the class with the largest probability.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/08-knn-classifier.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="regression" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="regression"><span class="header-section-number">7.1.2</span> Regression</h3>
<p>KNN regression estimates <span class="math inline">\(f(x_{0})\)</span> using the average of all the training responses in <span class="math inline">\(N_{0}\)</span>.</p>
<p><span class="math display">\[
\hat{f}(x_{0}) = \frac{1}{K}
                      \displaystyle\sum_{i \in N_{0}} y_{i}
\]</span></p>
<ul>
<li>Where
<ul>
<li><span class="math inline">\(x_{0}\)</span> is the test observation</li>
<li><span class="math inline">\(K\)</span> the number of points in the training data that are closest to <span class="math inline">\(x_{0}\)</span> and reduce the model flexibility</li>
<li><span class="math inline">\(N_{0}\)</span> points in the training data that are closest to <span class="math inline">\(x_{0}\)</span></li>
</ul></li>
</ul>
</section>
<section id="pre-processing" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="pre-processing"><span class="header-section-number">7.1.3</span> Pre-processing</h3>
<p>To use this method we need to make sure that all our variables are numeric. If one our variables is a factor we need to perform a dummy transformation of that variable with the <code>recipes::step_dummy</code> function.</p>
<p>On the other hand, as this model uses distances to make predicts it’s important to check that each feature of the input data is measured with <strong>the same range of values</strong> with the <code>recipes::step_range</code> function which normalize from 0 to 1 as happens with the dummy function.</p>
<p><span class="math display">\[
x' = \frac{x - \min(x)}{\max(x) - \min(x)}
\]</span></p>
<p>Another normalization alternative is centering the predictors in <span class="math inline">\(\overline{x} = 0\)</span> with <span class="math inline">\(S = 0\)</span> with the function <code>recipes::step_normalize</code> or the function <code>scale()</code> which apply the <a href="https://developers.google.com/machine-learning/data-prep/transform/normalization">z-score normalization</a>.</p>
<p><span class="math display">\[
x' = \frac{x - \mu}{\sigma}
\]</span></p>
</section>
<section id="coding-example" class="level3" data-number="7.1.4">
<h3 data-number="7.1.4" class="anchored" data-anchor-id="coding-example"><span class="header-section-number">7.1.4</span> Coding example</h3>
<p>To perform <strong>K-Nearest Neighbors</strong> we just need to create the model specification by using <strong>kknn</strong> engine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Smarket_train <span class="ot">&lt;-</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  Smarket <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">!=</span> <span class="dv">2005</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>Smarket_test <span class="ot">&lt;-</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  Smarket <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="dv">2005</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>knn_spec <span class="ot">&lt;-</span> <span class="fu">nearest_neighbor</span>(<span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>SmarketKnnPredictions <span class="ot">&lt;-</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  knn_spec <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Direction <span class="sc">~</span> Lag1 <span class="sc">+</span> Lag2, <span class="at">data =</span> Smarket_train) <span class="sc">|&gt;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(<span class="at">new_data =</span> Smarket_test) </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">conf_mat</span>(SmarketKnnPredictions, <span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction Down Up
      Down   43 58
      Up     68 83</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(SmarketKnnPredictions, <span class="at">truth =</span> Direction, <span class="at">estimate =</span> .pred_class) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary           0.5</code></pre>
</div>
</div>
</section>
</section>
<section id="tree-based-methods" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="tree-based-methods"><span class="header-section-number">7.2</span> Tree-Based Methods</h2>
<p>These methods involve <strong>stratifying the predictor</strong> space into a number of <em>simple regions</em> and then use mean or the mode response value for the training observations in the region to which it belongs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/48-Hitters-salary-regression-tree-regions.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As these results can be summarized in a tree, these types of approaches are known as <strong>decision tree</strong> methods, we have some important parts:</p>
<ul>
<li><em>Terminal nodes</em> (<em>leaves</em>) are represented by <span class="math inline">\(R_1\)</span>, <span class="math inline">\(R_2\)</span> and <span class="math inline">\(R_3\)</span>.</li>
<li><em>Internal nodes</em> refers to the points along the tree where the predictor space is split.</li>
<li><em>Branches</em> refer to the segments of the trees that connect the nodes.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/47-Hitters-salary-regression-tree.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>It’s important to take in consideration that the order in which is presented each predictors also explain the level of importance of each variable. For example, the number of <code>Years</code> has a higher effect over the player’s salary than the number of <code>Hits</code>.</p>
<section id="simple-trees" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="simple-trees"><span class="header-section-number">7.2.1</span> Simple trees</h3>
<section id="regression-1" class="level4">
<h4 class="anchored" data-anchor-id="regression-1">Regression</h4>
<p>To create a decision tree we need to find the regions <span class="math inline">\(R_1, \dots, R_j\)</span> that minimize the RSS where <span class="math inline">\(\hat{y}_{R_j}\)</span> represent the mean response for the training observations within the <em>j</em>th box:</p>
<p><span class="math display">\[
RSS = \sum_{j=1}^J \sum_{i \in R_j} (y_i - \hat{y}_{R_j})^2
\]</span></p>
<p>To define the regions we use the <strong>recursive binary splitting</strong>, which consist the predictor <span class="math inline">\(X_j\)</span> and the cutpoint <span class="math inline">\(s\)</span> leads to the greatest possible reduction in RSS. Next, we repeat the process, looking for the best predictor and best cutpoint in order to split the data further so as to minimize the RSS within each of the resulting regions. The process continues until a <em>stopping criterion is reached</em> (no region contains more than five observations).</p>
<p>This method is:</p>
<ul>
<li><p><em>Top-down</em>: It begins at the <em>top of the tree</em> (where all observations belong to a single region) and then successively splits the predictor space.</p></li>
<li><p><em>Greedy</em>: At each step of the tree-building process, <strong>the best split is made at that particular step</strong>, rather than looking ahead and picking a split that will lead to a better tree in some future step.</p></li>
</ul>
<p>As result, we could end with a very complex tree that <strong>overfits</strong> the data. To solve this, we need <strong>prune</strong> the original tree until getting a <strong>subtree</strong> that leads to the lowest test error rate by using the <strong>cost complexity pruning</strong> approach which creates differente trees based on <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[
\sum_{m=1}^{|T|} \sum_{i: x_i \in R_m} (y_i - \hat{y}_{R_m}) ^2  + \alpha|T|
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\alpha\)</span>: Tunning parameter <span class="math inline">\([0,\infty]\)</span> selected using <em>k-cross validation</em></li>
<li><span class="math inline">\(|T|\)</span>: Number of terminal nodes of the tree <span class="math inline">\(T\)</span>.</li>
<li><span class="math inline">\(R_m\)</span>: The subset of predictor space corresponding to the <span class="math inline">\(m\)</span>th terminal node</li>
<li><span class="math inline">\(\hat{y}_{R_m}\)</span>: Predicted response associated with <span class="math inline">\(R_m\)</span></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/49-tree-best-number-leaves.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="classification" class="level4">
<h4 class="anchored" data-anchor-id="classification">Classification</h4>
<p>For a classification tree, we predict that each observation belongs to the most <em>commonly occurring class</em> of training observations in the region to which it belongs.</p>
<p>As we can not use RSS as a criterion for making the binary splits, the <strong>classification error rate</strong> could the fraction of the training observations in that region that do not belong to the most common class (<span class="math inline">\(1 - \max_k(\hat{p}_{mk})\)</span>), but it turns out that classification error is not sufficiently sensitive for tree-growing and we use the next metrics as they are more sensitive to <strong>node purity</strong> (<em>proportion of the main class on each terminal node</em>):</p>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: center;">Formula</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Gini index</strong></td>
<td style="text-align: center;"><span class="math inline">\(G = \sum_{k = 1}^K 1 - \hat{p}_{mk} (1 -\hat{p}_{mk})\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Entropy</strong></td>
<td style="text-align: center;"><span class="math inline">\(D = -\sum_{k = 1}^K 1 - \hat{p}_{mk} \log \hat{p}_{mk}\)</span></td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/50-tree-classification-example.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="advantages-and-disadvantages" class="level4">
<h4 class="anchored" data-anchor-id="advantages-and-disadvantages">Advantages and disadvantages</h4>
<table class="table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Advantages</th>
<th style="text-align: left;">Disadvantages</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simpler to explain than linear regression thanks to its graphical representation</td>
<td style="text-align: left;">They aren’t so very good predicting results</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mirror very well human decision-making</td>
<td style="text-align: left;">Small change in the data can cause a large change in the final estimated tree</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Handle qualitative predictors without the need to create dummy variables</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="bagging-bootstrap-aggregation" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="bagging-bootstrap-aggregation"><span class="header-section-number">7.2.2</span> Bagging (bootstrap aggregation)</h3>
<p>As we said before, simple trees has a <em>high variance</em> problem <span class="math inline">\(Var(\hat{f}(x_{0}))\)</span> and <strong>bagging</strong> can help to mitigate this problem.</p>
<p>We know from the <em>Central Limit Theorem</em> a natural way to <em>reduce the variance</em> and <em>increase the test set accuracy</em> is taking many <strong>training sets from the population</strong>, build a separate prediction model using each training set, and average the resulting prediction, as for a given a set of <span class="math inline">\(n\)</span> <strong>independent observations</strong> <span class="math inline">\(Z_1, \dots, Z_n\)</span>, each with variance <span class="math inline">\(\sigma^2\)</span>, the variance of the mean <span class="math inline">\(\overline{Z}\)</span> of the observations is given by <span class="math inline">\(\sigma^2/n\)</span>.</p>
<p>As we generally do not have access to multiple training sets we use <strong>bootstrap</strong> to take repeated samples from the one training data set, train <span class="math inline">\(B\)</span> <strong>not pruned regression trees</strong> and <strong>average</strong> the resulting predictions or select the most commonly occurring class among the <span class="math inline">\(B\)</span> predictions in classification settings.</p>
<p><span class="math display">\[
\hat{f}_{bag}(x) = \frac{1}{B}\sum_{b=1}^B\hat{f}^{*b}(x)
\]</span></p>
<p>The <strong>number of trees is not a critical</strong> as <span class="math inline">\(B\)</span> will not lead to overfitting. Using <span class="math inline">\(B = 100\)</span> is sufficient to achieve good performance in this example.</p>
<section id="out-of-bag-error-estimation" class="level4">
<h4 class="anchored" data-anchor-id="out-of-bag-error-estimation">Out-of-bag error estimation</h4>
<p>To estimate the test error as an approximation of the <em>Leave-one-out cross validation</em> when <span class="math inline">\(B\)</span> sufficiently large, we can take advantage of the <span class="math inline">\(1/3\)</span> of observation that were <strong>out-of-bag</strong> (OOB) on each re-sample and predict the response for the <span class="math inline">\(i\)</span>th observation using each of the trees in which that observation was OOB.</p>
<p>This will yield around <span class="math inline">\(B/3\)</span> predictions for each of the <span class="math inline">\(n\)</span> observation that we can <em>average</em> or take a <em>majority</em> vote to calculate the <em>test error</em>.</p>
</section>
<section id="variable-importance-measures" class="level4">
<h4 class="anchored" data-anchor-id="variable-importance-measures">Variable importance measures</h4>
<p>After using this method, we can’t represent the statistical learning procedure using a single tree, instead we can use the <em>RSS</em> (or the <em>Gini index</em>) to record the total amount that the RSS is decreased due to splits over a given predictor, averaged(or added) over all <span class="math inline">\(B\)</span> trees where a large value indicates an important predictor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/51-bagging-variable-importance.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
</section>
<section id="random-forests" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="random-forests"><span class="header-section-number">7.2.3</span> Random Forests</h3>
<p>Predictions from the bagged trees, has a big problem, there are <strong>highly correlated</strong> and averaging many highly correlated quantities does not lead to as large of a reduction in variance as averaging many <strong>uncorrelated quantities</strong> (<em>independent</em>).</p>
<p>To solve this problem <strong>Random Forests</strong> provide an improvement over bagged trees by <strong>decorrelates the trees</strong>. As in bagging, we build many trees based on bootstrapped training samples. But when building these decision trees <em>random forest</em> sample <span class="math inline">\(m \approx \sqrt{p}\)</span> predictors to create <span class="math inline">\(B\)</span> *independent trees, making the average of the resulting trees less variable and hence more reliable..</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/52-random-forest-effect-over-bagging.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="boosting" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="boosting"><span class="header-section-number">7.2.4</span> Boosting</h3>
</section>
<section id="bayesian-additive-regression-trees-bart" class="level3" data-number="7.2.5">
<h3 data-number="7.2.5" class="anchored" data-anchor-id="bayesian-additive-regression-trees-bart"><span class="header-section-number">7.2.5</span> Bayesian additive regression trees (BART)</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./flexible-regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Flexible Regression Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./resampling-methods.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Resampling methods</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Non official solitions of An Introduction to Statistical Learning Second Edition</div>   
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>